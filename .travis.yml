os: windows
language: shell

env:
  global:
    - GOPATH: /c/gopath
    - GOROOT: /c/go
    - GOVERSION: 1.11.5
    - JAVA_HOME: /c/jdk

before_install:
  - rm -rf $JAVA_HOME $GOROOT
  - export PATH=$JAVA_HOME/bin:$GOPATH/bin:$GOPATH/bin/windows_386:$GOROOT/bin:/c/nodejs:$PATH
  - choco install jdk8 -params 'installdir=c:\\jdk'
  - choco install ant --ignore-dependencies
  - choco install nodejs.install -ia "INSTALLDIR=c:\\nodejs" -y
  - npm config set prefix "c:\\nodejs"
  - curl -fsS -o go$GOVERSION.windows-amd64.zip https://storage.googleapis.com/golang/go$GOVERSION.windows-amd64.zip
  - 7z x go$GOVERSION.windows-amd64.zip -y -o/c/
  - java -version
  - ant -version
  - go version
  - go env
  - node --version
  - npm --version

before_script:
  - git clone https://github.com/portapps/portapps ${TRAVIS_BUILD_DIR}/../portapps

script:
  - ant release

after_success:
  - export APP_VERSION=`cat $TRAVIS_BUILD_DIR/bin/tmp/version.dat`
  - echo $APP_VERSION

before_deploy:
  - git config --local user.email "builds@travis-ci.com"
  - git config --local user.name "Travis CI"
  - git tag $APP_VERSION -a -m "Generated tag from TravisCI for $APP_VERSION"
  - ls -al bin/release

deploy:
  provider: releases
  api_key:
    secure: sWHtOPjMy+fImk/dc1HjlJp5eGPiwn2eZ3lYJoTf8qM2hJ1eXOax9O0DnUxlDDMh5/uC37aSIb3HP4+MqQwn/FGrwnBgnhUBx+xtrtVXIgvKWqXw3499kTCiPnQeALK9LKNnW86PrKwi2pGCegpDvNAkBwmr1YQnszN390qJ1vawabJsR0gaVsZ4N2VbukfT4IbXgvxRuJ6bziO8yGYO/8hAvjLpVDvbEw9nLAI84k9oaJWQ9HVX0ziknu3epgobuIEkk1k/Zp+n+CoEJKAD2OlWvbhBattxvGw0NUYaiqGJ1GAhIgTf53Du6qTWWKWyZb8gLZ2hA6/rbNBuJhslgj/n7wBedoCqQEWSoVCN964Ou864MEBEJCQoXflv8X+BMl2OstCOic6ntEB/Qkc/68fjZfV4gTS7cOs1WVMfZpj0tnMgQ8C33fX0ncdqlMonEMwd9LhX8p0ztoQhmOZBLj7I/bfFr3fekU0Ax8HLeXbrzJMHNJBLs+HUh4wSAA8/E1qJo9k8eHwrKF12ZJh4lT2MveDIdUXUIpHt3BvYLdwVbE6VS/66f1GkUVd66C2oVnPnr2n1XF/J5XL/CzPmfJixqE34GYjhwCN00IbILTIC59BrytZQ/Z2SbZAiZOt2V1KTGU2L7icbbf+3pGgcgE3Q16A21bYjts/uiOMNLz4=
  file_glob: true
  file: bin/release/*
  skip_cleanup: true
  draft: true
  on:
    tags: false
